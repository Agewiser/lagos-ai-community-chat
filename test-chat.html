<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Naija Chat â€” Backend Test</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
      body { font-family: sans-serif; max-width: 600px; margin: 40px auto; padding: 0 20px; }
      #messages { border: 1px solid #ddd; height: 400px; overflow-y: auto; padding: 10px; margin-bottom: 10px; border-radius: 8px; }
      .message { margin-bottom: 12px; }
      .sender { font-weight: bold; }
      .user-msg .sender { color: #2563eb; }
      .ai-msg .sender { color: #16a34a; }
      .admin-msg .sender { color: #f97316; }
      input { width: 75%; padding: 8px; border: 1px solid #ddd; border-radius: 6px; }
      button { padding: 8px 16px; background: #2563eb; color: white; border: none; border-radius: 6px; cursor: pointer; }
    </style>
  </head>
  <body>
    <h2>ðŸ‡³ðŸ‡¬ Naija AI Chat â€” Test Room</h2>

    <div id="messages"></div>

    <div>
      <input id="msgInput" type="text" placeholder="Type a message..." />
      <button onclick="sendMessage()">Send</button>
    </div>

    <script>
      const socket = io("http://localhost:3001");
      const username = prompt("Enter your name:") || "Tester";

      // Once connected, announce you joined
      socket.on("connect", () => {
        socket.emit("user_joined", { username });
        addMessage("System", `You joined as ${username}`, "system-msg");
      });

      // Load existing chat history
      socket.on("chat_history", (history) => {
        history.forEach((msg) => addMessage(msg.sender, msg.text, msg.isAdmin ? "admin-msg" : msg.type + "-msg"));
      });

      // Receive new messages in real time
      socket.on("new_message", (msg) => {
        addMessage(msg.sender, msg.text, msg.isAdmin ? "admin-msg" : msg.type + "-msg");
      });

      function sendMessage() {
        const input = document.getElementById("msgInput");
        const text = input.value.trim();
        if (!text) return;

        socket.emit("user_message", { username, text });
        input.value = "";
      }

      // Send on Enter key
      document.getElementById("msgInput").addEventListener("keydown", (e) => {
        if (e.key === "Enter") sendMessage();
      });

      function addMessage(sender, text, cssClass) {
        const div = document.createElement("div");
        div.className = `message ${cssClass}`;
        div.innerHTML = `<span class="sender">${sender}:</span> ${text}`;
        const messages = document.getElementById("messages");
        messages.appendChild(div);
        messages.scrollTop = messages.scrollHeight;
      }
    </script>
  </body>
</html>